<div class="main-content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-body">
                        <div class="toolbar" *ngIf="dataSource">
                            <app-event-filter [filterData]="filterData" (filterVals)="outputFilter($event)" (resetSearchText)="resetSearchText()"></app-event-filter>
                        </div>
                        <div class="row">
                            <div class="col-sm-6"></div>
                            <div class="col-sm-6">
                                <button class="btn btn-primary float-right" mat-raised-button type="button" (click)="addPersonalTour()">
                                    <i class="material-icons">playlist_add</i> Add Personal Tour</button>
                                <div class="float-right mx-2">
                                    <mat-form-field>
                                        <input matInput [disabled]="!dataSource" [value]="tableState.searchText"
                                            (keyup)="applyFilter($event.target.value)" placeholder="Search results">
                                    </mat-form-field>
                                </div>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table [id]="tableId" mat-table [dataSource]="dataSource" matSort (matSortChange)="onSortChange($event)">
                                <!-- Checkbox Column -->
                                <ng-container matColumnDef="select">
                                    <th mat-header-cell *matHeaderCellDef class="pr-3">
                                        <mat-checkbox (change)="$event ? masterToggle() : null"
                                            [checked]="selection.hasValue() && isAllSelected()"
                                            [indeterminate]="selection.hasValue() && isPartiallySelected()">
                                        </mat-checkbox>
                                    </th>
                                    <td mat-cell *matCellDef="let row">
                                        <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(row) : null"
                                            [checked]="selection.isSelected(row)">
                                        </mat-checkbox>
                                    </td>
                                </ng-container>

                                <!-- Date Time Column -->
                                <ng-container matColumnDef="dateTime">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header>
                                        Date and Time
                                    </th>
                                    <td mat-cell *matCellDef="let element" (click)="editPersonalTour(element.id)">
                                        {{element.date | localeDate: dateDelimiter}}&nbsp;&nbsp;&nbsp;{{element.time}}
                                    </td>
                                </ng-container>

                                <!-- Campus Column -->
                                <ng-container matColumnDef="campus.name">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Campus</th>
                                    <td mat-cell *matCellDef="let element" (click)="editPersonalTour(element.id)">
                                        {{(element.campus)?element.campus.name:''}}</td>
                                </ng-container>

                                <!-- Assignee Column -->
                                <ng-container matColumnDef="assigneeName">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Assignee</th>
                                    <td mat-cell *matCellDef="let element" (click)="editPersonalTour(element.id)">{{element.assigneeName}}</td>
                                </ng-container>

                                <!-- Contact(s) Column -->
                                <ng-container matColumnDef="contacts">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Contact(s)</th>
                                    <td mat-cell *matCellDef="let element" (click)="editPersonalTour(element.id)">
                                        <ng-container *ngFor="let ptBooking of element.personalTourBookings; let i = index">
                                            <ng-container *ngFor="let contact of ptBooking.contacts; let y = index">
                                                <div class="l-cs" (click)="editContact(contact.id)">
                                                    {{contact.lastName}}, {{contact.firstName}};
                                                </div>
                                            </ng-container>
                                        </ng-container>
                                    </td>
                                </ng-container>

                                <!-- Student(s) Column -->
                                <ng-container matColumnDef="students">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Student(s)</th>
                                    <td mat-cell *matCellDef="let element" (click)="editPersonalTour(element.id)">
                                        <ng-container *ngFor="let ptBooking of element.personalTourBookings; let i = index">
                                            <ng-container *ngFor="let student of ptBooking.students; let y = index">
                                                <div class="l-cs" (click)="editStudent(student.id)">
                                                    {{student.lastName}}, {{student.firstName}};
                                                </div>
                                            </ng-container>
                                        </ng-container>
                                    </td>
                                </ng-container>

                                <!-- Total RSVP Column -->
                                <ng-container matColumnDef="attending">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Total RSVP</th>
                                    <td mat-cell *matCellDef="let element" (click)="editPersonalTour(element.id)">{{element.attending || '-'}}</td>
                                </ng-container>

                                <!-- Families Column -->
                                <ng-container matColumnDef="families">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Families</th>
                                    <td mat-cell *matCellDef="let element" (click)="editPersonalTour(element.id)">{{element.families || '-'}}</td>
                                </ng-container>

                                <!-- Total Checked In Column -->
                                <ng-container matColumnDef="checkins">
                                    <th mat-header-cell *matHeaderCellDef mat-sort-header>Total Checked In</th>
                                    <td mat-cell *matCellDef="let element" (click)="editPersonalTour(element.id)">{{element.checkins || '-'}}</td>
                                </ng-container>

                                <!-- Actions Column -->
                                <ng-container matColumnDef="actions">
                                    <th mat-header-cell *matHeaderCellDef> <span class="float-right">Actions</span></th>
                                    <td class="td-actions text-right" mat-cell *matCellDef="let element">
                                        <button mat-raised-button type="button" class="btn btn-success btn-link" matTooltip="Edit"
                                            matTooltipPosition="left" (click)="$event.stopPropagation(); editPersonalTour(element.id)">
                                            <i class="material-icons">edit</i>
                                        </button>
                                        <button mat-raised-button *ngIf="!userInfo.isSchoolRepresentative()" type="button" class="btn btn-light btn-link"
                                            matTooltip="Duplicate" matTooltipPosition="left" (click)="$event.stopPropagation(); duplicatePersonalTour(element.id)">
                                            <i class="material-icons">file_copy</i>
                                        </button>
                                        <button mat-raised-button *ngIf="!userInfo.isSchoolRepresentative()" type="button"
                                            class="btn btn-danger btn-link" matTooltip="Delete" matTooltipPosition="left"
                                            (click)="$event.stopPropagation(); deletePersonalTour(element.id)">
                                            <i class="material-icons">delete_outline</i>
                                        </button>
                                    </td>
                                </ng-container>

                                <!-- No Data -->
                                <ng-container matColumnDef="noData">
                                    <td [hidden]="!dataSource || (dataSource && dataSource.filteredData && dataSource.filteredData.length > 0)"
                                        mat-footer-cell *matFooterCellDef colspan="11">
                                        {{noDataInTable}}
                                    </td>
                                </ng-container>

                                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="selection.toggle(row)"></tr>
                                <tr mat-footer-row *matFooterRowDef="['noData']" class="text-center"></tr> <!-- No Data-->

                            </table>
                            <app-spinner [tableIsLoading]="tableIsLoading"></app-spinner>
                            <mat-paginator (page)="onPaginatorChange($event)"></mat-paginator>
                        </div>

                        <div class="row">
                            <div class="col-md-12 text-right">
                                <button *ngIf="visibleSelectedCount > 0" type="button" class="btn btn-delete" (click)="removeSelected()">
                                    Delete Selected Item(s)</button>
                                <button *ngIf="userInfo && (userInfo.isSchoolEditorOrHigher())" class="btn btn-primary pull-right"
                                    (click)="addPersonalTour()">
                                    <i class="material-icons">playlist_add</i> Add Personal Tour
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- end content-->
                </div>
                <!--  end card  -->
            </div>
            <!-- end col-md-12 -->
        </div>
        <!-- end row -->
    </div>
</div>