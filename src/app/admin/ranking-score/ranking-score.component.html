<div class="main-content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header card-header-icon card-header-primary">
                        <div class="card-icon">
                            <i class="material-icons-outlined">speed</i>
                        </div>
                        <h4 class="card-title">Ranking Score</h4>
                    </div>

                    <div class="card-body">
                        <div class="toolbar">
                            <div class="row">
                                <div class="col-md-8">
                                    <h4>Ranking score is always based on a score of 100. The maximum value for each of
                                        the selected criteria listed is used to calculate the maximum value. These are
                                        highlighted in green.
                                    </h4>
                                </div>
                                <div class="col-md-2">
                                    <point-view [label]="'Maximum Score'" [points]="maxScore" [isGreen]="isGreen">
                                    </point-view>
                                </div>
                                <div class="col-md-2"></div>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-no-bordered table-hover" *ngIf="rankingScores">
                                <thead>
                                    <tr>
                                        <th></th>
                                        <th>Criteria</th>
                                        <th>Status</th>
                                        <th>Score</th>
                                        <th>Value</th>
                                        <th class="text-right">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr *ngFor="let rs of rankingScores" [ngClass]="{hidden: rs.isDeleted || rs.hide}">
                                        <td>
                                            <mat-checkbox [checked]="rs.enabled" (change)="enabledChanged(rs.id, $event.checked)">
                                            </mat-checkbox>
                                        </td>
                                        <td>{{rs.criteriumId == null ? 'Unknown' : rs.criterium.name}}</td>
                                        <td>{{rs.listItem?.name || rs.enumValue || 'Unknown'}}</td>
                                        <td>
                                            <mat-slider color="primary" min="0" max="100" step="5"
                                                [(ngModel)]="rs.score" (input)="sliderChanged($event.value, rs.id)">
                                            </mat-slider>
                                        </td>
                                        <td [ngClass]="{green: rs.isGreen}">{{rs.score}}</td>
                                        <td class="td-actions text-right">
                                            <button mat-raised-button type="button" class="btn btn-success btn-link"
                                                matTooltip="Edit" matTooltipPosition="left"
                                                (click)="editRankingScore(rs.id)">
                                                <i class="material-icons">edit</i>
                                            </button>
                                            <button mat-raised-button type="button" class="btn btn-danger btn-link"
                                                matTooltip="Delete" matTooltipPosition="left"
                                                (click)="deleteRankingScore(rs.id)">
                                                <i class="material-icons">delete_outline</i>
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <div class="row">
                            <div class="col-md-12 text-right">
                                <button type="button" mat-raised-button class="btn btn-primary mx-1"
                                    (click)="editRankingScore(null)">
                                    <i class="material-icons">playlist_add</i> Add Ranking Score
                                </button>
                                <button type="button" mat-raised-button class="btn btn-success"
                                    [promiseBtn]="promiseForBtn" [disabled]="maxScore != 100 || pristine"
                                    (click)="doSubmit()">Save
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="rsModal" tabindex="-1" role="dialog" aria-labelledby="rsModalLabel">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <form [formGroup]="rankingScoreForm" class="form-horizontal m-0" novalidate
                        *ngIf="rankingScoreForm">
                        <div class="modal-header">
                            <h4 class="modal-title text-left" id="rsModalLabel">
                                <div *ngIf="editingRankingScore.criterium">
                                    Edit Criterion - {{ editingRankingScore.criterium.name }}
                                </div>
                                <div *ngIf="!editingRankingScore.criterium">Add New Criterion</div>
                            </h4>
                            <button type="button" class="close" data-dismiss="modal" (click)="endAction()"
                                aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <mat-checkbox [checked]="editingRankingScore.enabled" formControlName="enabled">
                                Activate Rule
                            </mat-checkbox>
                            <div class="label-floating">
                                <mat-form-field>
                                    <mat-select placeholder="Criteria" formControlName="criteriumId"
                                        (selectionChange)="criteriumChanged($event.value)" required>
                                        <mat-option *ngFor="let criterium of criteria" [value]="criterium.id">
                                            {{criterium.name}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                            <mat-form-field *ngIf="listItemRules?.length">
                                <mat-select placeholder="Rules" formControlName="listItemId"
                                    (selectionChange)="listItemChanged($event.value)"
                                    [disabled]="rankingScoreForm.controls.criteriumId.value === null" required>
                                    <mat-option *ngFor="let rule of listItemRules" [value]="rule.id">
                                        {{rule.name}}
                                    </mat-option>
                                </mat-select>
                                <mat-error *ngIf="rankingScoreForm.controls.listItemId.hasError('isAlreadyExist')">
                                    <small>A criteria already exists for this rule.</small>
                                </mat-error>
                            </mat-form-field>
                            <mat-form-field *ngIf="enumRules?.length">
                                <mat-select placeholder="Rules" formControlName="enumValue"
                                    (selectionChange)="enumChanged($event.value)"
                                    [disabled]="rankingScoreForm.controls.criteriumId.value === null" required>
                                    <mat-option *ngFor="let rule of enumRules" [value]="rule.id">
                                        {{rule.name}}
                                    </mat-option>
                                </mat-select>
                                <mat-error *ngIf="rankingScoreForm.controls.enumValue.hasError('isAlreadyExist')">
                                    <small>A criteria already exists for this rule.</small>
                                </mat-error>
                            </mat-form-field>
                            <mat-form-field>
                                <input matInput placeholder="Score" type="number" min="1" formControlName="score"
                                    required>
                                <mat-error
                                    [hidden]="rankingScoreForm.controls.score.valid || rankingScoreForm.controls.score.pristine">
                                    Score should be min 1 and max 100.
                                </mat-error>
                            </mat-form-field>
                        </div>
                        <div class="modal-footer">
                            <button type="button" mat-raised-button class="btn btn-cancel mx-1" data-dismiss="modal"
                                (click)="endAction()">Cancel</button>
                            <button type="button" mat-raised-button class="btn btn-success"
                                [disabled]="!rankingScoreForm.valid || rankingScoreForm.pristine "
                                (click)="saveRankingScore()">Save
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>